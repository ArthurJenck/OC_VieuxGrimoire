{"ast":null,"code":"/* eslint-disable react/jsx-props-no-spreading */import React,{useEffect,useState}from'react';import{useParams,Link}from'react-router-dom';import{useUser}from'../../lib/customHooks';import styles from'./Book.module.css';import{getBook,deleteBook}from'../../lib/common';import BookInfo from'../../components/Books/BookInfo/BookInfo';import BookRatingForm from'../../components/Books/BookRatingForm/BookRatingForm';import BookDeleteImage from'../../images/book_delete.png';import BestRatedBooks from'../../components/Books/BestRatedBooks/BestRatedBooks';import BackArrow from'../../components/BackArrow/BackArrow';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Book(){const{connectedUser,userLoading}=useUser();const[book,setBook]=useState(null);const[rating,setRating]=useState(0);const[userRated,setUserRated]=useState(false);const[loading,setLoading]=useState(true);const params=useParams();useEffect(()=>{async function getItem(){const data=await getBook(params.id);if(data){setBook(data);}}getItem();},[params.id]);useEffect(()=>{if(!userLoading&&connectedUser&&book!==null&&book!==void 0&&book.title){const rate=book.ratings.find(elt=>elt.userId===connectedUser.userId);if(rate){setUserRated(true);setRating(parseInt(rate.grade,10));setLoading(false);}else{setUserRated(false);setRating(0);setLoading(false);}}else if(!userLoading&&!connectedUser&&book){setLoading(false);}},[book,userLoading]);const onDelete=async e=>{if(e.key&&e.key!=='Enter'){return;}// eslint-disable-next-line no-restricted-globals\nconst check=confirm('Etes vous sûr de vouloir supprimer ce livre ?');if(check){const del=await deleteBook(book.id);if(del){setBook(oldValue=>({...oldValue,delete:true}));}}};const loadingContent=/*#__PURE__*/_jsx(\"h1\",{children:\"Chargement ...\"});const bookContent=!loading&&!book.delete?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.Book,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.BookImage,style:{backgroundImage:`url(\"${book.imageUrl}\")`}}),/*#__PURE__*/_jsxs(\"div\",{className:styles.BookContent,children:[(book===null||book===void 0?void 0:book.userId)===(connectedUser===null||connectedUser===void 0?void 0:connectedUser.userId)?/*#__PURE__*/_jsxs(\"div\",{className:styles.Owner,children:[/*#__PURE__*/_jsx(\"p\",{children:\"Vous avez publi\\xE9 cet ouvrage, vous pouvez le :\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(Link,{to:`/livre/modifier/${book.id}`,children:\"modifier\"}),' ',/*#__PURE__*/_jsx(\"span\",{tabIndex:0,role:\"button\",onKeyUp:onDelete,onClick:onDelete,children:\"supprimer\"}),' ']})]}):null,/*#__PURE__*/_jsx(BookInfo,{book:book}),/*#__PURE__*/_jsx(BookRatingForm,{userRated:userRated,userId:connectedUser===null||connectedUser===void 0?void 0:connectedUser.userId,rating:rating,setRating:setRating,setBook:setBook,id:book.id})]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(BestRatedBooks,{})]}):null;const deletedContent=book!==null&&book!==void 0&&book.delete?/*#__PURE__*/_jsxs(\"div\",{className:styles.Deleted,children:[/*#__PURE__*/_jsx(\"h1\",{children:book.title}),/*#__PURE__*/_jsx(\"p\",{children:\"a bien \\xE9t\\xE9 supprim\\xE9\"}),/*#__PURE__*/_jsx(\"img\",{src:BookDeleteImage,alt:`Le livre ${book.title} a bien été supprimé`}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",children:'Retour à l\\'accueil'})})]}):null;return/*#__PURE__*/_jsxs(\"div\",{className:\"content-container\",children:[/*#__PURE__*/_jsx(BackArrow,{}),loading?loadingContent:null,/*#__PURE__*/_jsx(\"div\",{className:styles.BookContainer,children:bookContent}),book!==null&&book!==void 0&&book.delete?deletedContent:null]});}export default Book;","map":{"version":3,"names":["React","useEffect","useState","useParams","Link","useUser","styles","getBook","deleteBook","BookInfo","BookRatingForm","BookDeleteImage","BestRatedBooks","BackArrow","jsx","_jsx","jsxs","_jsxs","Book","connectedUser","userLoading","book","setBook","rating","setRating","userRated","setUserRated","loading","setLoading","params","getItem","data","id","title","rate","ratings","find","elt","userId","parseInt","grade","onDelete","e","key","check","confirm","del","oldValue","delete","loadingContent","children","bookContent","className","BookImage","style","backgroundImage","imageUrl","BookContent","Owner","to","tabIndex","role","onKeyUp","onClick","deletedContent","Deleted","src","alt","type","BookContainer"],"sources":["C:/Users/ajenc/OneDrive/Dev/OpenClassrooms/Projet 6 - Back-end/VieuxGrimoire/src/pages/Book/Book.jsx"],"sourcesContent":["/* eslint-disable react/jsx-props-no-spreading */\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { useUser } from '../../lib/customHooks';\r\nimport styles from './Book.module.css';\r\nimport { getBook, deleteBook } from '../../lib/common';\r\nimport BookInfo from '../../components/Books/BookInfo/BookInfo';\r\nimport BookRatingForm from '../../components/Books/BookRatingForm/BookRatingForm';\r\nimport BookDeleteImage from '../../images/book_delete.png';\r\nimport BestRatedBooks from '../../components/Books/BestRatedBooks/BestRatedBooks';\r\nimport BackArrow from '../../components/BackArrow/BackArrow';\r\n\r\nfunction Book() {\r\n  const { connectedUser, userLoading } = useUser();\r\n  const [book, setBook] = useState(null);\r\n  const [rating, setRating] = useState(0);\r\n  const [userRated, setUserRated] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const params = useParams();\r\n\r\n  useEffect(() => {\r\n    async function getItem() {\r\n      const data = await getBook(params.id);\r\n      if (data) {\r\n        setBook(data);\r\n      }\r\n    }\r\n    getItem();\r\n  }, [params.id]);\r\n\r\n  useEffect(() => {\r\n    if (!userLoading && connectedUser && book?.title) {\r\n      const rate = book.ratings.find((elt) => elt.userId === connectedUser.userId);\r\n      if (rate) {\r\n        setUserRated(true);\r\n        setRating(parseInt(rate.grade, 10));\r\n        setLoading(false);\r\n      } else {\r\n        setUserRated(false);\r\n        setRating(0);\r\n        setLoading(false);\r\n      }\r\n    } else if (!userLoading && !connectedUser && book) {\r\n      setLoading(false);\r\n    }\r\n  }, [book, userLoading]);\r\n\r\n  const onDelete = async (e) => {\r\n    if (e.key && e.key !== 'Enter') {\r\n      return;\r\n    }\r\n    // eslint-disable-next-line no-restricted-globals\r\n    const check = confirm('Etes vous sûr de vouloir supprimer ce livre ?');\r\n    if (check) {\r\n      const del = await deleteBook(book.id);\r\n      if (del) {\r\n        setBook((oldValue) => ({ ...oldValue, delete: true }));\r\n      }\r\n    }\r\n  };\r\n\r\n  const loadingContent = (<h1>Chargement ...</h1>);\r\n\r\n  const bookContent = !loading && !book.delete ? (\r\n    <div>\r\n      <div className={styles.Book}>\r\n        <div className={styles.BookImage} style={{ backgroundImage: `url(\"${book.imageUrl}\")` }} />\r\n        <div className={styles.BookContent}>\r\n          {book?.userId === connectedUser?.userId ? (\r\n            <div className={styles.Owner}>\r\n              <p>Vous avez publié cet ouvrage, vous pouvez le :</p>\r\n              <p>\r\n                <Link to={`/livre/modifier/${book.id}`}>modifier</Link>\r\n                {' '}\r\n                <span tabIndex={0} role=\"button\" onKeyUp={onDelete} onClick={onDelete}>supprimer</span>\r\n                {' '}\r\n              </p>\r\n            </div>\r\n          ) : null}\r\n          <BookInfo book={book} />\r\n          <BookRatingForm\r\n            userRated={userRated}\r\n            userId={connectedUser?.userId}\r\n            rating={rating}\r\n            setRating={setRating}\r\n            setBook={setBook}\r\n            id={book.id}\r\n          />\r\n        </div>\r\n      </div>\r\n      <hr />\r\n      <BestRatedBooks />\r\n    </div>\r\n  ) : null;\r\n  const deletedContent = book?.delete ? (\r\n    <div className={styles.Deleted}>\r\n      <h1>{book.title}</h1>\r\n      <p>a bien été supprimé</p>\r\n      <img src={BookDeleteImage} alt={`Le livre ${book.title} a bien été supprimé`} />\r\n      <Link to=\"/\">\r\n        <button type=\"button\">{'Retour à l\\'accueil'}</button>\r\n      </Link>\r\n    </div>\r\n  ) : null;\r\n\r\n  return (\r\n    <div className=\"content-container\">\r\n      <BackArrow />\r\n      {loading ? loadingContent : null}\r\n      <div className={styles.BookContainer}>\r\n        {bookContent}\r\n      </div>\r\n      {book?.delete ? deletedContent : null}\r\n\r\n    </div>\r\n  );\r\n}\r\nexport default Book;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}