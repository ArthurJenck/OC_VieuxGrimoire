{"ast":null,"code":"import axios from'axios';import{API_ROUTES}from'../utils/constants';function formatBooks(bookArray){return bookArray.map(book=>{const newBook={...book};// eslint-disable-next-line no-underscore-dangle\nnewBook.id=newBook._id;return newBook;});}export function storeInLocalStorage(token,userId){localStorage.setItem('token',token);localStorage.setItem('userId',userId);}export function getFromLocalStorage(item){return localStorage.getItem(item);}export async function getAuthenticatedUser(){const defaultReturnObject={authenticated:false,user:null};try{const token=getFromLocalStorage('token');const userId=getFromLocalStorage('userId');if(!token){return defaultReturnObject;}return{authenticated:true,user:{userId,token}};}catch(err){console.error('getAuthenticatedUser, Something Went Wrong',err);return defaultReturnObject;}}export async function getBooks(){try{const response=await axios({method:'GET',url:`${API_ROUTES.BOOKS}`});// eslint-disable-next-line array-callback-return\nconst books=formatBooks(response.data);return books;}catch(err){console.error(err);return[];}}export async function getBook(id){try{const response=await axios({method:'GET',url:`${API_ROUTES.BOOKS}/${id}`});const book=response.data;// eslint-disable-next-line no-underscore-dangle\nbook.id=book._id;return book;}catch(err){console.error(err);return null;}}export async function getBestRatedBooks(){try{const response=await axios({method:'GET',url:`${API_ROUTES.BEST_RATED}`});return formatBooks(response.data);}catch(e){console.error(e);return[];}}export async function deleteBook(id){try{await axios.delete(`${API_ROUTES.BOOKS}/${id}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});return true;}catch(err){console.error(err);return false;}}export async function rateBook(id,userId,rating){const data={userId,rating:parseInt(rating,10)};try{const response=await axios.post(`${API_ROUTES.BOOKS}/${id}/rating`,data,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});const book=response.data;// eslint-disable-next-line no-underscore-dangle\nbook.id=book._id;return book;}catch(e){console.error(e);return e.message;}}export async function addBook(data){const userId=localStorage.getItem('userId');const book={userId,title:data.title,author:data.author,year:data.year,genre:data.genre,ratings:[{userId,grade:data.rating?parseInt(data.rating,10):0}],averageRating:parseInt(data.rating,10)};const bodyFormData=new FormData();bodyFormData.append('book',JSON.stringify(book));bodyFormData.append('image',data.file[0]);try{return await axios({method:'post',url:`${API_ROUTES.BOOKS}`,data:bodyFormData,headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});}catch(err){console.error(err);return{error:true,message:err.message};}}export async function updateBook(data,id){const userId=localStorage.getItem('userId');let newData;const book={userId,title:data.title,author:data.author,year:data.year,genre:data.genre};console.log(data.file[0]);if(data.file[0]){newData=new FormData();newData.append('book',JSON.stringify(book));newData.append('image',data.file[0]);}else{newData={...book};}try{const newBook=await axios({method:'put',url:`${API_ROUTES.BOOKS}/${id}`,data:newData,headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});return newBook;}catch(err){console.error(err);return{error:true,message:err.message};}}","map":{"version":3,"names":["axios","API_ROUTES","formatBooks","bookArray","map","book","newBook","id","_id","storeInLocalStorage","token","userId","localStorage","setItem","getFromLocalStorage","item","getItem","getAuthenticatedUser","defaultReturnObject","authenticated","user","err","console","error","getBooks","response","method","url","BOOKS","books","data","getBook","getBestRatedBooks","BEST_RATED","e","deleteBook","delete","headers","Authorization","rateBook","rating","parseInt","post","message","addBook","title","author","year","genre","ratings","grade","averageRating","bodyFormData","FormData","append","JSON","stringify","file","updateBook","newData","log"],"sources":["C:/Users/ajenc/OneDrive/Dev/OpenClassrooms/Projet 6 - Back-end/VieuxGrimoire/src/lib/common.js"],"sourcesContent":["import axios from 'axios';\r\nimport { API_ROUTES } from '../utils/constants';\r\n\r\nfunction formatBooks(bookArray) {\r\n  return bookArray.map((book) => {\r\n    const newBook = { ...book };\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    newBook.id = newBook._id;\r\n    return newBook;\r\n  });\r\n}\r\n\r\nexport function storeInLocalStorage(token, userId) {\r\n  localStorage.setItem('token', token);\r\n  localStorage.setItem('userId', userId);\r\n}\r\n\r\nexport function getFromLocalStorage(item) {\r\n  return localStorage.getItem(item);\r\n}\r\n\r\nexport async function getAuthenticatedUser() {\r\n  const defaultReturnObject = { authenticated: false, user: null };\r\n  try {\r\n    const token = getFromLocalStorage('token');\r\n    const userId = getFromLocalStorage('userId');\r\n    if (!token) {\r\n      return defaultReturnObject;\r\n    }\r\n    return { authenticated: true, user: { userId, token } };\r\n  } catch (err) {\r\n    console.error('getAuthenticatedUser, Something Went Wrong', err);\r\n    return defaultReturnObject;\r\n  }\r\n}\r\n\r\nexport async function getBooks() {\r\n  try {\r\n    const response = await axios({\r\n      method: 'GET',\r\n      url: `${API_ROUTES.BOOKS}`,\r\n    });\r\n    // eslint-disable-next-line array-callback-return\r\n    const books = formatBooks(response.data);\r\n    return books;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getBook(id) {\r\n  try {\r\n    const response = await axios({\r\n      method: 'GET',\r\n      url: `${API_ROUTES.BOOKS}/${id}`,\r\n    });\r\n    const book = response.data;\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    book.id = book._id;\r\n    return book;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getBestRatedBooks() {\r\n  try {\r\n    const response = await axios({\r\n      method: 'GET',\r\n      url: `${API_ROUTES.BEST_RATED}`,\r\n    });\r\n    return formatBooks(response.data);\r\n  } catch (e) {\r\n    console.error(e);\r\n    return [];\r\n  }\r\n}\r\nexport async function deleteBook(id) {\r\n  try {\r\n    await axios.delete(`${API_ROUTES.BOOKS}/${id}`, {\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n    return true;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function rateBook(id, userId, rating) {\r\n  const data = {\r\n    userId,\r\n    rating: parseInt(rating, 10),\r\n  };\r\n\r\n  try {\r\n    const response = await axios.post(`${API_ROUTES.BOOKS}/${id}/rating`, data, {\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n    const book = response.data;\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    book.id = book._id;\r\n    return book;\r\n  } catch (e) {\r\n    console.error(e);\r\n    return e.message;\r\n  }\r\n}\r\n\r\nexport async function addBook(data) {\r\n  const userId = localStorage.getItem('userId');\r\n  const book = {\r\n    userId,\r\n    title: data.title,\r\n    author: data.author,\r\n    year: data.year,\r\n    genre: data.genre,\r\n    ratings: [{\r\n      userId,\r\n      grade: data.rating ? parseInt(data.rating, 10) : 0,\r\n    }],\r\n    averageRating: parseInt(data.rating, 10),\r\n  };\r\n  const bodyFormData = new FormData();\r\n  bodyFormData.append('book', JSON.stringify(book));\r\n  bodyFormData.append('image', data.file[0]);\r\n\r\n  try {\r\n    return await axios({\r\n      method: 'post',\r\n      url: `${API_ROUTES.BOOKS}`,\r\n      data: bodyFormData,\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    return { error: true, message: err.message };\r\n  }\r\n}\r\n\r\nexport async function updateBook(data, id) {\r\n  const userId = localStorage.getItem('userId');\r\n\r\n  let newData;\r\n  const book = {\r\n    userId,\r\n    title: data.title,\r\n    author: data.author,\r\n    year: data.year,\r\n    genre: data.genre,\r\n  };\r\n  console.log(data.file[0]);\r\n  if (data.file[0]) {\r\n    newData = new FormData();\r\n    newData.append('book', JSON.stringify(book));\r\n    newData.append('image', data.file[0]);\r\n  } else {\r\n    newData = { ...book };\r\n  }\r\n\r\n  try {\r\n    const newBook = await axios({\r\n      method: 'put',\r\n      url: `${API_ROUTES.BOOKS}/${id}`,\r\n      data: newData,\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n    return newBook;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return { error: true, message: err.message };\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}