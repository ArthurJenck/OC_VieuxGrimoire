{"ast":null,"code":"/* eslint-disable react/jsx-props-no-spreading */import React,{useEffect,useMemo,useState}from'react';import{useForm}from'react-hook-form';import{useNavigate}from'react-router-dom';import{generateStarsInputs}from'../../../lib/functions';import{useFilePreview}from'../../../lib/customHooks';import addFileIMG from'../../../images/add_file.png';import styles from'./BookForm.module.css';import{updateBook,addBook}from'../../../lib/common';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function BookForm(_ref){var _book$ratings$find;let{book,validate}=_ref;const userRating=book?(_book$ratings$find=book.ratings.find(elt=>elt.userId===localStorage.getItem('userId')))===null||_book$ratings$find===void 0?void 0:_book$ratings$find.grade:0;const[rating,setRating]=useState(0);const navigate=useNavigate();const{register,watch,formState,handleSubmit,reset}=useForm({defaultValues:useMemo(()=>({title:book===null||book===void 0?void 0:book.title,author:book===null||book===void 0?void 0:book.author,year:book===null||book===void 0?void 0:book.year,genre:book===null||book===void 0?void 0:book.genre}),[book])});useEffect(()=>{reset(book);},[book]);const file=watch(['file']);const[filePreview]=useFilePreview(file);useEffect(()=>{setRating(userRating);},[userRating]);useEffect(()=>{if(!book&&formState.dirtyFields.rating){const rate=document.querySelector('input[name=\"rating\"]:checked').value;setRating(parseInt(rate,10));formState.dirtyFields.rating=false;}},[formState]);const onSubmit=async data=>{// When we create a new book\nif(!book){if(!data.file[0]){alert('Vous devez ajouter une image');}if(!data.rating){/* eslint-disable no-param-reassign */data.rating=0;/* eslint-enable no-param-reassign */}const newBook=await addBook(data);if(!newBook.error){validate(true);}else{alert(newBook.message);}}else{const updatedBook=await updateBook(data,data.id);if(!updatedBook.error){navigate('/');}else{alert(updatedBook.message);}}};const readOnlyStars=!!book;return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),className:styles.Form,children:[/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",id:\"id\",...register('id')}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"title\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Titre du livre\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"title\",...register('title')})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"author\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Auteur\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"author\",...register('author')})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"year\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Ann\\xE9e de publication\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"year\",...register('year')})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"genre\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Genre\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"genre\",...register('genre')})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"rate\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Note\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.Stars,children:generateStarsInputs(rating,register,readOnlyStars)})]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"file\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Visuel\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.AddImage,children:filePreview||book!==null&&book!==void 0&&book.imageUrl?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:filePreview!==null&&filePreview!==void 0?filePreview:book===null||book===void 0?void 0:book.imageUrl,alt:\"preview\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Modifier\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:addFileIMG,alt:\"Add file\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Ajouter une image\"})]})}),/*#__PURE__*/_jsx(\"input\",{...register('file'),type:\"file\",id:\"file\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Publier\"})]});}BookForm.defaultProps={book:null,validate:null};export default BookForm;","map":{"version":3,"names":["React","useEffect","useMemo","useState","useForm","useNavigate","generateStarsInputs","useFilePreview","addFileIMG","styles","updateBook","addBook","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BookForm","_ref","_book$ratings$find","book","validate","userRating","ratings","find","elt","userId","localStorage","getItem","grade","rating","setRating","navigate","register","watch","formState","handleSubmit","reset","defaultValues","title","author","year","genre","file","filePreview","dirtyFields","rate","document","querySelector","value","parseInt","onSubmit","data","alert","newBook","error","message","updatedBook","id","readOnlyStars","className","Form","children","type","htmlFor","Stars","AddImage","imageUrl","src","alt","defaultProps"],"sources":["C:/Users/ajenc/OneDrive/Dev/OpenClassrooms/Projet 6 - Back-end/VieuxGrimoire/src/components/Books/BookForm/BookForm.jsx"],"sourcesContent":["/* eslint-disable react/jsx-props-no-spreading */\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport * as PropTypes from 'prop-types';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { generateStarsInputs } from '../../../lib/functions';\r\nimport { useFilePreview } from '../../../lib/customHooks';\r\nimport addFileIMG from '../../../images/add_file.png';\r\nimport styles from './BookForm.module.css';\r\nimport { updateBook, addBook } from '../../../lib/common';\r\n\r\nfunction BookForm({ book, validate }) {\r\n  const userRating = book ? book.ratings.find((elt) => elt.userId === localStorage.getItem('userId'))?.grade : 0;\r\n\r\n  const [rating, setRating] = useState(0);\r\n\r\n  const navigate = useNavigate();\r\n  const {\r\n    register, watch, formState, handleSubmit, reset,\r\n  } = useForm({\r\n    defaultValues: useMemo(() => ({\r\n      title: book?.title,\r\n      author: book?.author,\r\n      year: book?.year,\r\n      genre: book?.genre,\r\n    }), [book]),\r\n  });\r\n  useEffect(() => {\r\n    reset(book);\r\n  }, [book]);\r\n  const file = watch(['file']);\r\n  const [filePreview] = useFilePreview(file);\r\n\r\n  useEffect(() => {\r\n    setRating(userRating);\r\n  }, [userRating]);\r\n\r\n  useEffect(() => {\r\n    if (!book && formState.dirtyFields.rating) {\r\n      const rate = document.querySelector('input[name=\"rating\"]:checked').value;\r\n      setRating(parseInt(rate, 10));\r\n      formState.dirtyFields.rating = false;\r\n    }\r\n  }, [formState]);\r\n\r\n  const onSubmit = async (data) => {\r\n    // When we create a new book\r\n    if (!book) {\r\n      if (!data.file[0]) {\r\n        alert('Vous devez ajouter une image');\r\n      }\r\n      if (!data.rating) {\r\n        /* eslint-disable no-param-reassign */\r\n        data.rating = 0;\r\n        /* eslint-enable no-param-reassign */\r\n      }\r\n      const newBook = await addBook(data);\r\n      if (!newBook.error) {\r\n        validate(true);\r\n      } else {\r\n        alert(newBook.message);\r\n      }\r\n    } else {\r\n      const updatedBook = await updateBook(data, data.id);\r\n      if (!updatedBook.error) {\r\n        navigate('/');\r\n      } else {\r\n        alert(updatedBook.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const readOnlyStars = !!book;\r\n  return (\r\n    <form onSubmit={handleSubmit(onSubmit)} className={styles.Form}>\r\n      <input type=\"hidden\" id=\"id\" {...register('id')} />\r\n      <label htmlFor=\"title\">\r\n        <p>Titre du livre</p>\r\n        <input type=\"text\" id=\"title\" {...register('title')} />\r\n      </label>\r\n      <label htmlFor=\"author\">\r\n        <p>Auteur</p>\r\n        <input type=\"text\" id=\"author\" {...register('author')} />\r\n      </label>\r\n      <label htmlFor=\"year\">\r\n        <p>Ann√©e de publication</p>\r\n        <input type=\"text\" id=\"year\" {...register('year')} />\r\n      </label>\r\n      <label htmlFor=\"genre\">\r\n        <p>Genre</p>\r\n        <input type=\"text\" id=\"genre\" {...register('genre')} />\r\n      </label>\r\n      <label htmlFor=\"rate\">\r\n        <p>Note</p>\r\n        <div className={styles.Stars}>\r\n          {generateStarsInputs(rating, register, readOnlyStars)}\r\n        </div>\r\n      </label>\r\n      <label htmlFor=\"file\">\r\n        <p>Visuel</p>\r\n        <div className={styles.AddImage}>\r\n          {filePreview || book?.imageUrl ? (\r\n            <>\r\n              <img src={filePreview ?? book?.imageUrl} alt=\"preview\" />\r\n              <p>Modifier</p>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <img src={addFileIMG} alt=\"Add file\" />\r\n              <p>Ajouter une image</p>\r\n            </>\r\n          )}\r\n\r\n        </div>\r\n        <input {...register('file')} type=\"file\" id=\"file\" />\r\n      </label>\r\n      <button type=\"submit\">Publier</button>\r\n    </form>\r\n  );\r\n}\r\n\r\nBookForm.propTypes = {\r\n  book: PropTypes.shape({\r\n    id: PropTypes.string,\r\n    _id: PropTypes.string,\r\n    userId: PropTypes.string,\r\n    title: PropTypes.string,\r\n    author: PropTypes.string,\r\n    year: PropTypes.number,\r\n    imageUrl: PropTypes.string,\r\n    genre: PropTypes.string,\r\n    ratings: PropTypes.arrayOf(PropTypes.shape({\r\n      userId: PropTypes.string,\r\n      grade: PropTypes.number,\r\n    })),\r\n    averageRating: PropTypes.number,\r\n  }),\r\n  validate: PropTypes.func,\r\n};\r\n\r\nBookForm.defaultProps = {\r\n  book: null,\r\n  validate: null,\r\n};\r\nexport default BookForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}